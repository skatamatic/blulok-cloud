feat: implement comprehensive key distribution system with v1/v2 gateway support

This commit implements a complete key distribution system for managing
user device access keys across lock devices, with support for both v1
(hex-encoded keys with key codes) and v2 (ED25519 public keys) gateway
protocols.

## Key Distribution System Foundation

### Database Schema
- Add user_devices table to track app device IDs and public keys
- Add device_key_distributions table for tracking key distribution status
- Add gateway_commands table for durable command queue
- Add system_settings table for configurable limits
- Add key_code and key_version fields to distributions
- Add indexes for performance on (user_device_id, status) and (target_id, status)
- Add unique constraint to prevent duplicate pending operations

### Core Services
- KeyDistributionService: Manages key lifecycle with smart diff logic
  - Enqueues add/remove operations based on tenancy changes
  - Implements retry logic with exponential backoff
  - Auto-activates user devices when all keys distributed
  - Prevents concurrent key rotations for same device
- CommandQueueService: Durable queue for gateway commands
- CommandWorkerService: Processes queued commands with proper error handling
- UserDeviceModel: Tracks user devices and their public keys

### Gateway Enhancements
- Add key management versioning (v1/v2) to gateway configuration
- Implement addKey/removeKey methods on IGateway interface
- HttpGateway supports both v1 (hex keys + key codes) and v2 (ED25519 public keys)
- GatewayService routes key operations to appropriate gateways
- Add ignore_ssl_cert option for development/testing
- Enhanced error handling and status broadcasting

### API Endpoints
- POST /api/v1/user-devices/register-key: Register device public key
- POST /api/v1/user-devices/me/rotate-key: Force new key for current device
- DELETE /api/v1/user-devices/admin/:id: DEV_ADMIN device deletion
- GET /api/v1/users/:id/details: User details with device info
- GET /api/v1/system-settings: Retrieve system settings
- PUT /api/v1/system-settings: Update system settings (DEV_ADMIN only)

## FMS Integration Improvements

### Enhanced Sync Experience
- Add FMS sync progress tracking with real-time updates
- Implement change review modal for reviewing FMS updates before applying
- Add sync status bar showing current sync state
- Create FMSSyncContext for managing sync state across components
- Improve error handling and validation for FMS operations

### Provider Support
- Add StorEdge provider with OAuth1 authentication
- Enhance base provider with better error handling
- Add facility scoping for multi-facility FMS operations
- Improve change detection and conflict resolution

### Database Changes
- Enforce unique internal mapping for FMS entities
- Add validation fields to fms_changes table
- Remove deprecated unit size/rate fields
- Add facility_id scoping to FMS operations

## Gateway Management UI

### Configuration Interface
- Add key management version selector (v1/v2)
- Add SSL certificate ignore option
- Improve gateway status indicators (online/offline/error/simulated)
- Enhanced test connection functionality with lock fetch
- Detailed sync logs with error reporting
- Real-time status updates via WebSocket

### User Experience
- Expandable configuration cards with consistent styling
- Clear status messages and error feedback
- Manual sync with progress indication
- Last sync timestamp display

## User Management Enhancements

### User Details View
- Tabbed interface (Summary, Facilities, Devices)
- Display user's facility and unit associations
- Show device information for DEV_ADMIN users
- Display key distribution status per device
- Allow DEV_ADMIN to delete user devices
- Show associated locks and distribution errors

### Device Management
- Track user device IDs, platforms, and public keys
- Display device status (pending_key, active, revoked)
- Show last used timestamps
- Link devices to their key distributions

## WebSocket & Subscription Improvements

### Subscription Management
- Fix duplicate subscription cleanup issues
- Add gateway status subscription manager
- Add FMS sync progress subscription manager
- Add command queue subscription manager
- Improve subscription registry with success/failure indicators
- Enhanced client-side subscription tracking with unique IDs

### Real-time Updates
- Gateway status changes broadcast to all clients
- FMS sync progress updates during operations
- Command queue status updates
- Proper cleanup on disconnect

## Testing Infrastructure

### Test Organization
- Move test utilities to dedicated __tests__/utils directory
- Add comprehensive mocks for new services
- Update existing tests for new functionality
- Add integration test helpers

### New Test Coverage
- KeyDistributionService: enqueue, process, rotation, smart diff
- UserDeviceModel: CRUD operations, validation
- Gateway services: v1/v2 key operations, connection handling
- API routes: RBAC, validation, error cases
- WebSocket subscriptions: authorization, cleanup

## UI/UX Improvements

### Component Enhancements
- Add device and unit filter components
- Improve battery status widget with better error states
- Enhance widget layouts and responsiveness
- Add edit unit modal for unit management
- Improve form validation and error display

### Styling Consistency
- Consistent card layouts across views
- Unified status pill styling
- Better dark mode support
- Improved loading states and skeletons

## System Settings

### Configurable Options
- Max devices per user (default: 2)
- Exposed in admin settings UI
- Enforced during device registration
- Validated on key rotation

## Security & RBAC

### Access Control
- DEV_ADMIN-only endpoints properly protected
- User device operations scoped to authenticated user
- Facility-scoped FMS operations
- WebSocket subscription authorization

### Key Security
- ED25519 public/private key pairs
- Secure key storage (only public keys stored)
- Key rotation support
- Automatic key revocation on device deletion

## Reliability & Error Handling

### Retry Logic
- Exponential backoff for failed key distributions
- Configurable retry limits
- Track retry count per distribution
- Gateway-level failure tracking

### Durability
- Command queue persists across server restarts
- Track gateway_id for lock movement detection
- Idempotent command processing
- Proper transaction handling

## Documentation
- Add FACILITY_SCOPING_IMPLEMENTATION.md
- Update API documentation for new endpoints
- Add inline code documentation
- Update user.plan.md with implementation status

## Breaking Changes
- None - all changes are additive

## Migration Notes
- Run database migrations in order (013-022)
- Existing gateways default to v1 key management
- No data migration required for existing users
- System settings initialized with defaults

Migrations:
- 013_enforce_unique_internal_mapping.ts
- 014_add_fms_change_validation_fields.ts
- 015_remove_unit_size_rate_fields.ts
- 016_add_gateway_configuration_fields.ts
- 017_add_user_device_keys.ts
- 018_add_system_settings.ts
- 019_add_key_distribution_retry_fields.ts
- 020_add_gateway_key_management_version.ts
- 021_add_gateway_ignore_ssl_cert.ts
- 021_add_keydist_keycode_version_indexes.ts
- 022_create_gateway_commands.ts

